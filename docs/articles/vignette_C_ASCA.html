<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>C. ASCA • HDANOVA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="C. ASCA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">HDANOVA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/vignette_A_data.html">A. Data handling</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_B_ANOVA.html">B. Analysis of Variance</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_C_ASCA.html">C. ASCA</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_D_additional.html">D. Additional methods</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/khliland/HDANOVA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>C. ASCA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/khliland/HDANOVA/blob/HEAD/vignettes/vignette_C_ASCA.Rmd" class="external-link"><code>vignettes/vignette_C_ASCA.Rmd</code></a></small>
      <div class="d-none name"><code>vignette_C_ASCA.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start the HDANOVA R package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/khliland/HDANOVA/" class="external-link">HDANOVA</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'HDANOVA'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     loadings</span></span></code></pre></div>
<div class="section level2">
<h2 id="analysis-of-variance-simultaneous-component-analysis-asca">Analysis of Variance Simultaneous Component Analysis (ASCA)<a class="anchor" aria-label="anchor" href="#analysis-of-variance-simultaneous-component-analysis-asca"></a>
</h2>
<p>The ANOVA part of ASCA includes all the possible variations of ANOVA
demonstrated in the ANOVA section and more. Also, generalized linear
models (GLM) can be used. The following theory will be exemplified:</p>
<ul>
<li>Basic ASCA
<ul>
<li>Permutation testing</li>
<li>Random effects</li>
<li>Scores and loadings</li>
<li>Data and confidence ellipsoids</li>
<li>Combined effects</li>
<li>Numeric effects</li>
</ul>
</li>
<li>ANOVA-PCA (APCA)</li>
<li>PC-ANOVA</li>
<li>MSCA</li>
<li>LiMM-PCA</li>
</ul>
<div class="section level3">
<h3 id="basic-asca">Basic ASCA<a class="anchor" aria-label="anchor" href="#basic-asca"></a>
</h3>
<p>The ANOVA part of ASCA includes all the possible variations of ANOVA
demonstrated in the ANOVA vignette and more. Also generalized linear
models (GLM) can be used. We start by demonstrating ASCA with a fixed
effect model of two factors with interactions and ordinary PCA on the
effect matrices.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Candy data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">candies</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit ASCA model</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asca.html">asca</a></span><span class="op">(</span><span class="va">assessment</span> <span class="op">~</span> <span class="va">candy</span><span class="op">*</span><span class="va">assessor</span>, data<span class="op">=</span><span class="va">candies</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Anova Simultaneous Component Analysis fitted using 'lm' (Linear Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation </span></span>
<span><span class="co">#&gt;                 Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; candy          33416.66        74.48</span></span>
<span><span class="co">#&gt; assessor        1961.37         4.37</span></span>
<span><span class="co">#&gt; assessor:candy  3445.73         7.68</span></span>
<span><span class="co">#&gt; Residuals       6043.52        13.47</span></span></code></pre></div>
<p>The summary shows that the candy effect is the largest by far.</p>
<div class="section level4">
<h4 id="permutation-testing">Permutation testing<a class="anchor" aria-label="anchor" href="#permutation-testing"></a>
</h4>
<p>To get more insight, we can perform permutation testing of the
factors. Here we use approximate permutation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Permutation testing (default = 1000 permutations, if not specified)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asca.html">asca</a></span><span class="op">(</span><span class="va">assessment</span> <span class="op">~</span> <span class="va">candy</span><span class="op">*</span><span class="va">assessor</span>, data<span class="op">=</span><span class="va">candies</span>, permute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Anova Simultaneous Component Analysis fitted using 'lm' (Linear Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation, 1000 permutations </span></span>
<span><span class="co">#&gt;                 Sum.Sq. Expl.var.(%) p-value</span></span>
<span><span class="co">#&gt; candy          33416.66        74.48       0</span></span>
<span><span class="co">#&gt; assessor        1961.37         4.37       0</span></span>
<span><span class="co">#&gt; assessor:candy  3445.73         7.68       0</span></span>
<span><span class="co">#&gt; Residuals       6043.52        13.47      NA</span></span></code></pre></div>
<p>Here we see that all effects are significant, where the Candy effect
is the dominating one. (The P-values are rounded from 0.001 to 0 in the
print). This can also be visualised by looking at the sums-of-squares
values obtained under permutation compared to the original value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/asca_plots.html">permutationplot</a></span><span class="op">(</span><span class="va">mod</span>, factor <span class="op">=</span> <span class="st">"assessor"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="random-effects">Random effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h4>
<p>One can argue that the assessors are random effects, thus should be
handled as such in the model. We can do this by adding r() around the
assessor term. See also LiMM-PCA below for the REML estimation
version.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit ASCA model with random assessor</span></span>
<span><span class="va">mod.mixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asca.html">asca</a></span><span class="op">(</span><span class="va">assessment</span> <span class="op">~</span> <span class="va">candy</span><span class="op">*</span><span class="fu">r</span><span class="op">(</span><span class="va">assessor</span><span class="op">)</span>, data<span class="op">=</span><span class="va">candies</span>, permute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.mixed</span><span class="op">)</span></span>
<span><span class="co">#&gt; Anova Simultaneous Component Analysis fitted using 'lmm' (Linear Mixed Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation, 1000 permutations </span></span>
<span><span class="co">#&gt;                 Sum.Sq. Expl.var.(%) p-value</span></span>
<span><span class="co">#&gt; candy          33416.66        74.48       0</span></span>
<span><span class="co">#&gt; assessor        1961.37         4.37       0</span></span>
<span><span class="co">#&gt; assessor:candy  3445.73         7.68       0</span></span>
<span><span class="co">#&gt; Residuals       6043.52        13.47      NA</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="scores-and-loadings">Scores and loadings<a class="anchor" aria-label="anchor" href="#scores-and-loadings"></a>
</h4>
<p>The effects can be visualised through, e.g., loading and score plots
to assess the relations between variables, objects and factors. If a
factor is not specified, the first factor is plotted.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">loadingplot</a></span><span class="op">(</span><span class="va">mod</span>, scatter<span class="op">=</span><span class="cn">TRUE</span>, labels<span class="op">=</span><span class="st">"names"</span>, main<span class="op">=</span><span class="st">"Candy loadings"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod</span>, main<span class="op">=</span><span class="st">"Candy scores"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-6-1.png" width="432"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
<p>A specific factor can be plotted by specifying the factor name or
number.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">loadingplot</a></span><span class="op">(</span><span class="va">mod</span>, factor<span class="op">=</span><span class="st">"assessor"</span>, scatter<span class="op">=</span><span class="cn">TRUE</span>, labels<span class="op">=</span><span class="st">"names"</span>, main<span class="op">=</span><span class="st">"Assessor loadings"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod</span>, factor<span class="op">=</span><span class="st">"assessor"</span>, main<span class="op">=</span><span class="st">"Assessor scores"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-7-1.png" width="432"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
<p>Score plots can be modified, e.g., omitting backprojections or adding
spider plots.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod</span>, factor<span class="op">=</span><span class="st">"assessor"</span>, main<span class="op">=</span><span class="st">"Assessor scores"</span>, projections<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod</span>, factor<span class="op">=</span><span class="st">"assessor"</span>, main<span class="op">=</span><span class="st">"Assessor scores"</span>, spider<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-8-1.png" width="432"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
<p>And scores and loadings can be extracted for further analysis.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pls/man/scores.html" class="external-link">loadings</a></span><span class="op">(</span><span class="va">mod</span>, factor<span class="op">=</span><span class="st">"candy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 Comp 1        Comp 2      Comp 3      Comp 4</span></span>
<span><span class="co">#&gt; transparent  0.3927649  0.0279168248 -0.30598369  0.77398098</span></span>
<span><span class="co">#&gt; acid        -0.1649285 -0.8042012208  0.47650301  0.24192158</span></span>
<span><span class="co">#&gt; sweet       -0.2235032  0.4607791525  0.52330000 -0.01751194</span></span>
<span><span class="co">#&gt; raspberry   -0.2277610  0.3663430297  0.35862959  0.50808527</span></span>
<span><span class="co">#&gt; texture     -0.4302019 -0.0004154248 -0.13000106  0.22107937</span></span>
<span><span class="co">#&gt; strength     0.3653312  0.0694885591  0.09828578 -0.09582978</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pls/man/scores.html" class="external-link">scores</a></span><span class="op">(</span><span class="va">mod</span>, factor<span class="op">=</span><span class="st">"candy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Comp 1   Comp 2     Comp 3    Comp 4</span></span>
<span><span class="co">#&gt; 1 -16.81343 4.844756 -0.2914198 0.1811588</span></span>
<span><span class="co">#&gt; 2 -16.81343 4.844756 -0.2914198 0.1811588</span></span>
<span><span class="co">#&gt; 3 -16.81343 4.844756 -0.2914198 0.1811588</span></span>
<span><span class="co">#&gt; 4 -16.81343 4.844756 -0.2914198 0.1811588</span></span>
<span><span class="co">#&gt; 5 -16.81343 4.844756 -0.2914198 0.1811588</span></span>
<span><span class="co">#&gt; 6 -16.81343 4.844756 -0.2914198 0.1811588</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="data-ellipsoids-and-confidence-ellipsoids">Data ellipsoids and confidence ellipsoids<a class="anchor" aria-label="anchor" href="#data-ellipsoids-and-confidence-ellipsoids"></a>
</h4>
<p>To emphasize factor levels or assess factor level differences, we can
add data ellipsoids or confidence ellipsoids to the score plot. The
confidence ellipsoids are built on the assumption of balanced data, and
their theories are built around crossed designs.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod</span>, ellipsoids<span class="op">=</span><span class="st">"data"</span>, factor<span class="op">=</span><span class="st">"candy"</span>, main<span class="op">=</span><span class="st">"Data ellipsoids"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod</span>, ellipsoids<span class="op">=</span><span class="st">"confidence"</span>, factor<span class="op">=</span><span class="st">"candy"</span>, main<span class="op">=</span><span class="st">"Confidence ellipsoids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-10-1.png" width="432"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
<p>If we repeat this for the mixed model, we see that both types of
ellipsoids change together with the change in denominator term in the
underlying ANOVA model. It should be noted that the theory for
confidence ellipsoids in mixed models is not fully developed, so
interpretation should be done with caution.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod.mixed</span>, ellipsoids<span class="op">=</span><span class="st">"data"</span>, factor<span class="op">=</span><span class="st">"candy"</span>, main<span class="op">=</span><span class="st">"Data ellipsoids"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod.mixed</span>, ellipsoids<span class="op">=</span><span class="st">"confidence"</span>, factor<span class="op">=</span><span class="st">"candy"</span>, main<span class="op">=</span><span class="st">"Confidence ellipsoids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-11-1.png" width="432"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combined-effects">Combined effects<a class="anchor" aria-label="anchor" href="#combined-effects"></a>
</h4>
<p>In some cases, it can be of interest to combine effects in ASCA.
Here, we use an example with the Caldana data where we combine the
<em>light</em> effect with the <em>time:light</em> interaction using the
<em>comb()</em> function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Caldana data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">caldana</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combined effects</span></span>
<span><span class="va">mod.comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asca.html">asca</a></span><span class="op">(</span><span class="va">compounds</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fu">comb</span><span class="op">(</span><span class="va">light</span> <span class="op">+</span> <span class="va">light</span><span class="op">:</span><span class="va">time</span><span class="op">)</span>, data<span class="op">=</span><span class="va">caldana</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.comb</span><span class="op">)</span></span>
<span><span class="co">#&gt; Anova Simultaneous Component Analysis fitted using 'lm' (Linear Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation </span></span>
<span><span class="co">#&gt;                  Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; time              154.58         9.69</span></span>
<span><span class="co">#&gt; light+light:time  349.64        21.92</span></span>
<span><span class="co">#&gt; Residuals        1091.14        68.39</span></span></code></pre></div>
<p>When combined effects have a time factor, the scores can be plotted
against time.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scores plotted as a function of time</span></span>
<span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/timeplot.html">timeplot</a></span><span class="op">(</span><span class="va">mod.comb</span>, factor<span class="op">=</span><span class="st">"light"</span>, time<span class="op">=</span><span class="st">"time"</span>, comb<span class="op">=</span><span class="fl">2</span>, comp<span class="op">=</span><span class="fl">1</span>, x_time<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/timeplot.html">timeplot</a></span><span class="op">(</span><span class="va">mod.comb</span>, factor<span class="op">=</span><span class="st">"light"</span>, time<span class="op">=</span><span class="st">"time"</span>, comb<span class="op">=</span><span class="fl">2</span>, comp<span class="op">=</span><span class="fl">2</span>, x_time<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="quantitative-effects">Quantitative effects<a class="anchor" aria-label="anchor" href="#quantitative-effects"></a>
</h4>
<p>Quantitative effects, so-called covariates, can also be included in a
model, though their use in ASCA are limited to ANOVA estimation and
explained variance, not being used in subsequent PCA or permutation
testing. We demonstrate this using the Caldana data again, but now
recode the time effect to a quantitative effect, meaning it will be
handled as a linear continuous effect.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">caldanaNum</span> <span class="op">&lt;-</span> <span class="va">caldana</span></span>
<span><span class="va">caldanaNum</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">caldanaNum</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asca.html">asca</a></span><span class="op">(</span><span class="va">compounds</span> <span class="op">~</span> <span class="va">time</span><span class="op">*</span><span class="va">light</span>, data <span class="op">=</span> <span class="va">caldanaNum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.num</span><span class="op">)</span></span>
<span><span class="co">#&gt; Anova Simultaneous Component Analysis fitted using 'lm' (Linear Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation </span></span>
<span><span class="co">#&gt;            Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; time         55.42         3.47</span></span>
<span><span class="co">#&gt; light       102.49         6.42</span></span>
<span><span class="co">#&gt; light:time  109.56         6.87</span></span>
<span><span class="co">#&gt; Residuals  1327.90        83.23</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="anova-pca-apca">ANOVA-PCA (APCA)<a class="anchor" aria-label="anchor" href="#anova-pca-apca"></a>
</h3>
<p>APCA differs from ASCA by adding the error term to the model before
performing PCA instead of backprojecting errors afterwards.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit APCA model</span></span>
<span><span class="va">modp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apca.html">apca</a></span><span class="op">(</span><span class="va">assessment</span> <span class="op">~</span> <span class="va">candy</span><span class="op">*</span><span class="va">assessor</span>, data<span class="op">=</span><span class="va">candies</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Anova Principal Component Analysis fitted using 'lm' (Linear Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation </span></span>
<span><span class="co">#&gt;                 Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; candy          33416.66        74.48</span></span>
<span><span class="co">#&gt; assessor        1961.37         4.37</span></span>
<span><span class="co">#&gt; assessor:candy  3445.73         7.68</span></span>
<span><span class="co">#&gt; Residuals       6043.52        13.47</span></span></code></pre></div>
<p>Plot scores and loadings.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">loadingplot</a></span><span class="op">(</span><span class="va">modp</span>, scatter<span class="op">=</span><span class="cn">TRUE</span>, labels<span class="op">=</span><span class="st">"names"</span>, main<span class="op">=</span><span class="st">"Candy loadings"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">modp</span>, main<span class="op">=</span><span class="st">"Candy scores"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-16-1.png" width="432"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pc-anova">PC-ANOVA<a class="anchor" aria-label="anchor" href="#pc-anova"></a>
</h3>
<p>In PC-ANOVA, a PCA is first applied to the data before the scores are
subjected to ANOVA, effectively reversing the roles in ASCA. This means
there will be one or more ANOVA tables in the summary of the output. In
this example, we have chosen to use the number of components that
explain at least 90% of the variation of the data.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcanova.html">pcanova</a></span><span class="op">(</span><span class="va">assessment</span> <span class="op">~</span> <span class="va">candy</span> <span class="op">*</span> <span class="va">assessor</span>, data <span class="op">=</span> <span class="va">candies</span>, ncomp <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod.pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; PC-ANOVA - Principal Components Analysis of Variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; pcanova(formula = assessment ~ candy * assessor, data = candies,     ncomp = 0.9)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; PC-ANOVA - Principal Components Analysis of Variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; pcanova(formula = assessment ~ candy * assessor, data = candies,     ncomp = 0.9)</span></span>
<span><span class="co">#&gt; $`Comp. 1`</span></span>
<span><span class="co">#&gt; Anova Table (Type II tests)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: assessment</span></span>
<span><span class="co">#&gt;                 Sum Sq  Df  F value  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; candy          31470.6   4 780.1762 &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; assessor         224.9  10   2.2304 0.02089 *  </span></span>
<span><span class="co">#&gt; candy:assessor   707.7  40   1.7545 0.01158 *  </span></span>
<span><span class="co">#&gt; Residuals       1109.3 110                     </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Comp. 2`</span></span>
<span><span class="co">#&gt; Anova Table (Type II tests)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: assessment</span></span>
<span><span class="co">#&gt;                Sum Sq  Df F value    Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; candy          1573.8   4 33.1604 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; assessor        278.3  10  2.3455 0.0150274 *  </span></span>
<span><span class="co">#&gt; candy:assessor 1053.3  40  2.2193 0.0005888 ***</span></span>
<span><span class="co">#&gt; Residuals      1305.2 110                      </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Comp. 3`</span></span>
<span><span class="co">#&gt; Anova Table (Type II tests)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: assessment</span></span>
<span><span class="co">#&gt;                 Sum Sq  Df F value    Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; candy           307.12   4   7.646 1.790e-05 ***</span></span>
<span><span class="co">#&gt; assessor       1006.62  10  10.024 8.574e-12 ***</span></span>
<span><span class="co">#&gt; candy:assessor  484.02  40   1.205    0.2229    </span></span>
<span><span class="co">#&gt; Residuals      1104.61 110                      </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>When creating score and loading plots for PC-ANOVA, the ‘global’
scores and loadings will be shown, but the factors can still be used for
manipulating the symbols.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">loadingplot</a></span><span class="op">(</span><span class="va">mod.pc</span>, scatter<span class="op">=</span><span class="cn">TRUE</span>, labels<span class="op">=</span><span class="st">"names"</span>, main<span class="op">=</span><span class="st">"Global loadings"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod.pc</span>, main<span class="op">=</span><span class="st">"Global scores"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-18-1.png" width="432"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="msca">MSCA<a class="anchor" aria-label="anchor" href="#msca"></a>
</h3>
<p>Multilevel Simultaneous Component Analysis (MSCA) is a version of
ASCA that assumes a single factor to be used as a between-individuals
factor, while the the within-individuals is assumed implicitly.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default MSCA model with a single factor</span></span>
<span><span class="va">mod.msca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msca.html">msca</a></span><span class="op">(</span><span class="va">assessment</span> <span class="op">~</span> <span class="va">candy</span>, data<span class="op">=</span><span class="va">candies</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.msca</span><span class="op">)</span></span>
<span><span class="co">#&gt; Multilevel Simultaneous Component Analysis fitted using 'lm' (Linear Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation </span></span>
<span><span class="co">#&gt;          Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; Between 33416.66        74.48</span></span>
<span><span class="co">#&gt; Within  11450.62        25.52</span></span></code></pre></div>
<p>Scoreplots can be created for the between-individuals factor and the
within-individuals factor, and for each level of the within-individuals
factor.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scoreplot for between-individuals factor</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod.msca</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Scoreplot of within-individuals factor</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod.msca</span>, factor<span class="op">=</span><span class="st">"within"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-20-2.png" width="576"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># .. per factor level</span></span>
<span><span class="va">par.old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mod.msca</span><span class="op">$</span><span class="va">scores.within</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod.msca</span>, factor<span class="op">=</span><span class="st">"within"</span>, within_level<span class="op">=</span><span class="va">i</span>, </span>
<span>           main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Level: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mod.msca</span><span class="op">$</span><span class="va">scores.within</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           panel.first<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">0</span>,h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"gray"</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">par.old</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-20-3.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="limm-pca">LiMM-PCA<a class="anchor" aria-label="anchor" href="#limm-pca"></a>
</h3>
<p>A version of LiMM-PCA is also implemented in HDANOVA. It combines
REML-estimated mixed models with PCA and scales the back-projected
errors according to degrees of freedom or effective dimensions (user
choice).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default LiMM-PCA model with two factors and interaction, 8 PCA components</span></span>
<span><span class="va">mod.reml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/limmpca.html">limmpca</a></span><span class="op">(</span><span class="va">assessment</span> <span class="op">~</span> <span class="va">candy</span><span class="op">*</span><span class="fu">r</span><span class="op">(</span><span class="va">assessor</span><span class="op">)</span>, data<span class="op">=</span><span class="va">candies</span>, pca.in<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.reml</span><span class="op">)</span></span>
<span><span class="co">#&gt; LiMM-PCA fitted using 'lmm' (Linear Mixed Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, REML estimation </span></span>
<span><span class="co">#&gt;                 Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; candy          33415.98        74.73</span></span>
<span><span class="co">#&gt; assessor:candy   697.41         1.56</span></span>
<span><span class="co">#&gt; assessor         874.25         1.96</span></span>
<span><span class="co">#&gt; Residuals       7619.78        17.04</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod.reml</span>, factor<span class="op">=</span><span class="st">"candy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-21-1.png" width="576"></p>
<p>One can also use least squares estimation without REML. This affects
the random effects and scaling of backprojections.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># LiMM-PCA with least squares estimation and 8 PCA components</span></span>
<span><span class="va">mod.ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/limmpca.html">limmpca</a></span><span class="op">(</span><span class="va">assessment</span> <span class="op">~</span> <span class="va">candy</span><span class="op">*</span><span class="fu">r</span><span class="op">(</span><span class="va">assessor</span><span class="op">)</span>, data<span class="op">=</span><span class="va">candies</span>, REML<span class="op">=</span><span class="cn">NULL</span>, pca.in<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.ls</span><span class="op">)</span></span>
<span><span class="co">#&gt; LiMM-PCA fitted using 'lmm' (Linear Mixed Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation </span></span>
<span><span class="co">#&gt;                 Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; candy          33415.98        74.73</span></span>
<span><span class="co">#&gt; assessor        1948.75         4.36</span></span>
<span><span class="co">#&gt; assessor:candy  3419.04         7.65</span></span>
<span><span class="co">#&gt; Residuals       5934.46        13.27</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pls/man/scoreplot.html" class="external-link">scoreplot</a></span><span class="op">(</span><span class="va">mod.ls</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_C_ASCA_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="repeated-measures">Repeated measures<a class="anchor" aria-label="anchor" href="#repeated-measures"></a>
</h3>
<p>We revisit the simulated data from the ANOVA vignette to demonstrate
ASCA with repeated measures. The data are subset, a time effect is
added, and the response is extended to the multivariate case.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Original simulation</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  feed  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>,<span class="st">"high"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">6</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  breed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NRF"</span>,<span class="st">"Hereford"</span>,<span class="st">"Angus"</span><span class="op">)</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  bull  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daughter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  age   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">48</span>, mean <span class="op">=</span> <span class="fl">36</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">yield</span> <span class="op">&lt;-</span> <span class="fl">150</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">10</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">feed</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">breed</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                        <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bull</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">daughter</span>, <span class="fl">48</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                        <span class="fl">0.5</span> <span class="op">*</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">48</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Extended to repeated measures</span></span>
<span><span class="va">long</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"feed"</span>, <span class="st">"daughter"</span>, <span class="st">"yield"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">long</span>, <span class="va">long</span><span class="op">)</span></span>
<span><span class="va">long</span><span class="op">$</span><span class="va">time</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each<span class="op">=</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">long</span><span class="op">$</span><span class="va">yield</span> <span class="op">&lt;-</span> <span class="va">long</span><span class="op">$</span><span class="va">yield</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">24</span>, sd <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">200</span>,<span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="co"># Made multiresponse (no added structure, only noise)</span></span>
<span><span class="va">long</span><span class="op">$</span><span class="va">yield</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">long</span><span class="op">$</span><span class="va">yield</span>,<span class="fl">10</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">long</span><span class="op">$</span><span class="va">yield</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">long</span><span class="op">$</span><span class="va">yield</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Analysing the data with ASCA using the least squares approach.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Least squares mixed model ASCA</span></span>
<span><span class="va">mod.rm.asca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asca.html">asca</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="fu">r</span><span class="op">(</span><span class="va">daughter</span><span class="op">)</span> <span class="op">+</span> <span class="va">feed</span><span class="op">*</span><span class="fu">r</span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">long</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.rm.asca</span><span class="op">)</span></span>
<span><span class="co">#&gt; Anova Simultaneous Component Analysis fitted using 'lmm' (Linear Mixed Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, least squares estimation </span></span>
<span><span class="co">#&gt;               Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; daughter  25823243.07        56.94</span></span>
<span><span class="co">#&gt; feed       2943221.37         6.49</span></span>
<span><span class="co">#&gt; time       4309830.00         9.50</span></span>
<span><span class="co">#&gt; feed:time    57834.68         0.13</span></span>
<span><span class="co">#&gt; Residuals 12215570.92        26.94</span></span></code></pre></div>
<p>Corresponding analysis using the LiMM-PCA approach with REML
estimation.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># REML mixed model LiMM-PCA</span></span>
<span><span class="va">mod.rm.limmpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/limmpca.html">limmpca</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="fu">r</span><span class="op">(</span><span class="va">daughter</span><span class="op">)</span> <span class="op">+</span> <span class="va">feed</span><span class="op">*</span><span class="fu">r</span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">long</span>, pca.in<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.rm.limmpca</span><span class="op">)</span></span>
<span><span class="co">#&gt; LiMM-PCA fitted using 'lmm' (Linear Mixed Model) </span></span>
<span><span class="co">#&gt; - SS type II, sum coding, restricted model, REML estimation </span></span>
<span><span class="co">#&gt;               Sum.Sq. Expl.var.(%)</span></span>
<span><span class="co">#&gt; feed       2943219.99         6.49</span></span>
<span><span class="co">#&gt; feed:time        0.34         0.00</span></span>
<span><span class="co">#&gt; daughter  21672823.11        47.79</span></span>
<span><span class="co">#&gt; time       1905738.81         4.20</span></span>
<span><span class="co">#&gt; Residuals 12938703.95        28.53</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kristian Hovde Liland.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
